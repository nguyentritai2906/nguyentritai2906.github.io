<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Tensorboard Projector Image Visualizer with Tensorflow 2 | nttai</title>
<meta name="keywords" content="Machine Learning, Tensorboard" />
<meta name="description" content="There are not much infomation on the internet on how to visualize your embeddings with Tensorboard. I&rsquo;ve had a hard time trying to make it work properly. Although there&rsquo;re some tutorial on the internet but most of them are for Tensorflow 1 and I didn&rsquo;t find the Tensorboard guide documentation page much help. So here&rsquo;s how I make it works and hopefully it&rsquo;ll help you too. But before we continue, I&rsquo;ll assume you already have an image dataset with labels and a model ready.">
<meta name="author" content="Nguyen Tri Tai">
<link rel="canonical" href="https://blog.nguyentritai.tk/posts/2022/tensorboard-projector-image-visualizer/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.258309a8cbd70e6f8f22e7e835f7cf1dbd70d1c793875353813389b8419684d9.css" integrity="sha256-JYMJqMvXDm&#43;PIufoNffPHb1w0ceTh1NTgTOJuEGWhNk=" rel="preload stylesheet" as="style">
<link rel="preload" href="/avatar.png" as="image">
<link rel="icon" href="https://blog.nguyentritai.tk/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://blog.nguyentritai.tk/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://blog.nguyentritai.tk/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://blog.nguyentritai.tk/apple-touch-icon.png">
<link rel="mask-icon" href="https://blog.nguyentritai.tk/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.92.0" />
<link rel="alternate" hreflang="en" href="https://blog.nguyentritai.tk/posts/2022/tensorboard-projector-image-visualizer/" />

<meta property="og:title" content="Tensorboard Projector Image Visualizer with Tensorflow 2" />
<meta property="og:description" content="There are not much infomation on the internet on how to visualize your embeddings with Tensorboard. I&rsquo;ve had a hard time trying to make it work properly. Although there&rsquo;re some tutorial on the internet but most of them are for Tensorflow 1 and I didn&rsquo;t find the Tensorboard guide documentation page much help. So here&rsquo;s how I make it works and hopefully it&rsquo;ll help you too. But before we continue, I&rsquo;ll assume you already have an image dataset with labels and a model ready." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.nguyentritai.tk/posts/2022/tensorboard-projector-image-visualizer/" />
<meta property="og:image" content="https://blog.nguyentritai.tk/posts/2022/tensorboard-projector-image-visualizer/cover.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-06-10T21:21:31&#43;07:00" />
<meta property="article:modified_time" content="2022-06-10T21:21:31&#43;07:00" /><meta property="og:site_name" content="nttai" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://blog.nguyentritai.tk/posts/2022/tensorboard-projector-image-visualizer/cover.png" />
<meta name="twitter:title" content="Tensorboard Projector Image Visualizer with Tensorflow 2"/>
<meta name="twitter:description" content="There are not much infomation on the internet on how to visualize your embeddings with Tensorboard. I&rsquo;ve had a hard time trying to make it work properly. Although there&rsquo;re some tutorial on the internet but most of them are for Tensorflow 1 and I didn&rsquo;t find the Tensorboard guide documentation page much help. So here&rsquo;s how I make it works and hopefully it&rsquo;ll help you too. But before we continue, I&rsquo;ll assume you already have an image dataset with labels and a model ready."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://blog.nguyentritai.tk/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Tensorboard Projector Image Visualizer with Tensorflow 2",
      "item": "https://blog.nguyentritai.tk/posts/2022/tensorboard-projector-image-visualizer/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Tensorboard Projector Image Visualizer with Tensorflow 2",
  "name": "Tensorboard Projector Image Visualizer with Tensorflow 2",
  "description": "There are not much infomation on the internet on how to visualize your embeddings with Tensorboard. I\u0026rsquo;ve had a hard time trying to make it work properly. Although there\u0026rsquo;re some tutorial on the internet but most of them are for Tensorflow 1 and I didn\u0026rsquo;t find the Tensorboard guide documentation page much help. So here\u0026rsquo;s how I make it works and hopefully it\u0026rsquo;ll help you too. But before we continue, I\u0026rsquo;ll assume you already have an image dataset with labels and a model ready.",
  "keywords": [
    "Machine Learning", "Tensorboard"
  ],
  "articleBody": "There are not much infomation on the internet on how to visualize your embeddings with Tensorboard. I’ve had a hard time trying to make it work properly. Although there’re some tutorial on the internet but most of them are for Tensorflow 1 and I didn’t find the Tensorboard guide documentation page much help. So here’s how I make it works and hopefully it’ll help you too. But before we continue, I’ll assume you already have an image dataset with labels and a model ready.\nOkay let’s dive in. Here’s what we’ll need to do:\n Use our model to predict the training set and take the output of embedding layer. Create a sprite image for projecting image on Tensorboard. Save the labels (and others if avalable) to a metadata.tsv file Save a tensorflow checkpoint with embedding vectors as tf.Variable  All these files must be saved in the same folder since later we’ll call Tensorboard and specify this directory as log_dir for it to find the necessary files.\nFeature extract model First create your model and load the appropriate weight. Mine is just a pretrain ResNet50 with an additional dense layer with 64 neurons as my embedding layer.\nmodel = create_model(cfg) log_dir = 'embedding_log' ckpt_path = tf.train.latest_checkpoint('./checkpoints/ckpt0') if ckpt_path is not None: print(\"Load ckpt from {}\".format(ckpt_path)) model.load_weights(ckpt_path).expect_partial() else: raise ValueError(\"No ckpt found\") Next we’ll save the model embedding vectors for future runs. Here I’ll loop through the train dataset, predict on a batch of images and then save the embedding vectors, labels and images to their appropriate list. If you have the labels and images ready, you can just call model.predict(train_dataset) directly. It’ll process the whole dataset and output an embedding matrix. This way, you don’t have to loop through the dataset like I do here.\nimage_list = [] label_list = [] embedding_list = [] for batch in tqdm(train_dataset, total=steps_per_epoch + 1): images, labels = batch[0] embeddings = model.predict((images, labels)) embedding_list.append(embeddings) label_list.append(np.argmax(labels, axis=1)) image_list.append(images.numpy() * 255) embeddings = np.concatenate(embedding_list, axis=0) labels = np.concatenate(label_list, axis=0) images = np.concatenate(image_list, axis=0) # Should save these for future runs # Use an if-else block to check if the files exist # So you don't have to loop through the dataset every run. np.save(os.path.join(log_dir, 'embeddings.npy'), embeddings) print(\"Saved embeddings to {}\".format(os.path.join(log_dir, 'embeddings.npy'))) np.save(os.path.join(log_dir, 'labels.npy'), labels) print(\"Saved labels to {}\".format(os.path.join(log_dir, 'labels.npy'))) np.save(os.path.join(log_dir, 'images.npy'), images) print(\"Saved images to {}\".format(os.path.join(log_dir, 'images.npy'))) print(\"Embeddings shape: {}\".format(embeddings.shape)) print(\"Labels shape: {}\".format(labels.shape)) print(\"Images shape: {}\".format(images.shape))  Embeddings shape: (100, 64)  Labels shape: (100, )  Images shape: (100, 256, 256, 3) $ ls -alh embedding_log/ drwxr-xr-x 3 nttai nttai 4.0K Jun 11 15:00 . drwxrwxr-x 18 nttai nttai 4.0K Jun 10 10:23 .. -rw-r--r-- 1 nttai nttai 7.5M Jun 10 10:24 embeddings.npy -rw-r--r-- 1 nttai nttai 45G Jun 10 10:27 images.npy -rw-r--r-- 1 nttai nttai 481K Jun 10 10:27 labels.npy Sprite image Next we’ll have to create a sprite image so that when we project its embedding vector onto three dimensional space, Tensorboard will use these thumbnails we create instead of just a bunch of dots. Just make sure that the indexes stay the same.\nKeep in mind that Tensorboard only accept sprite image with maximum dimension of 8192x8192 pixels so you should select only a subset of the training set. Here, since my train_dataset only have 100 images, I’ll save each thumbnail with size of 256x256 pixels.\ndef images_to_sprite(images, log_dir, size): one_square_size = int(np.ceil(np.sqrt(len(images)))) master_width = size * one_square_size master_height = size * one_square_size spriteimage = Image.new( mode='RGBA', size=(master_width, master_height), color=(0, 0, 0, 0) ) print(\"Writing sprite image to {}\".format( os.path.join(log_dir, 'sprite.jpg'))) for count, image in tqdm(enumerate(images), total=len(images)): div, mod = divmod(count, one_square_size) h_loc = size * div w_loc = size * mod image = image.squeeze() image = Image.fromarray(image.astype(np.uint8)).resize((size, size)) spriteimage.paste(image, (w_loc, h_loc)) spriteimage.convert('RGB').save(f'{log_dir}/sprite.jpg', transparency=0) thumbnail_size = 256 images_to_sprite(images, log_dir, thumbnail_size)  Fashion sprite image   $ ls -alh embedding_log/ drwxr-xr-x 3 nttai nttai 4.0K Jun 11 15:00 . drwxrwxr-x 18 nttai nttai 4.0K Jun 10 10:23 .. -rw-r--r-- 1 nttai nttai 7.5M Jun 10 10:24 embeddings.npy -rw-r--r-- 1 nttai nttai 45G Jun 10 10:27 images.npy -rw-r--r-- 1 nttai nttai 481K Jun 10 10:27 labels.npy -rw-r--r-- 1 nttai nttai 144K Jun 11 15:00 sprite.jpg Metadata to tsv file If you have class names or image ids and you want to display it rather than its class label you can write those as another column. Note that when there’re more than one column, you’re required to write the column labels as the first row, separated by tabs like so.\nlabel name image_path 1 0 cat images/cat/1.jpg 2 1 dog images/dog/1.jpg 3 1 dog images/dog/2.jpg ... ... ... ... Since I only have image labels, I’ll use the writerows() method of python csv package.\nwith open(f'{log_dir}/metadata.tsv', 'w') as fw: csv_writer = csv.writer(fw, delimiter=\"\\t\") csv_writer.writerows(np.expand_dims(labels, axis=1)) print(\"Labels saved to {}\".format(os.path.join(log_dir, 'metadata.tsv'))) Values inside metadata.tsv should look something like this.\n2304 1\t865 2\t3224 3\t1440 4\t3122 5\t4285 6\t334 7\t5282 8\t1744 9\t1026 10\t6774 ... ... $ ls -alh embedding_log/ drwxr-xr-x 3 nttai nttai 4.0K Jun 11 15:00 . drwxrwxr-x 18 nttai nttai 4.0K Jun 10 10:23 .. -rw-r--r-- 1 nttai nttai 7.5M Jun 10 10:24 embeddings.npy -rw-r--r-- 1 nttai nttai 45G Jun 10 10:27 images.npy -rw-r--r-- 1 nttai nttai 481K Jun 10 10:27 labels.npy -rw-r--r-- 1 nttai nttai 585 Jun 11 15:00 metadata.tsv -rw-r--r-- 1 nttai nttai 144K Jun 11 15:00 sprite.jpg Embedding checkpoint Now create a tf.Variable with the embeddings we extracted above and save it to the same log_dir directory.\nembeddings = tf.Variable(embeddings, name='embeddings') checkpoint = tf.train.Checkpoint(embedding=embeddings) checkpoint.save(os.path.join(log_dir, \"embedding.ckpt\")) $ ls -alh embedding_log/ drwxr-xr-x 3 nttai nttai 4.0K Jun 11 15:00 . drwxrwxr-x 18 nttai nttai 4.0K Jun 10 10:23 .. -rw-r--r-- 1 nttai nttai 89 Jun 11 15:00 checkpoint -rw-r--r-- 1 nttai nttai 13K Jun 11 15:00 embedding.ckpt-1.data-00000-of-00001 -rw-r--r-- 1 nttai nttai 264 Jun 11 15:00 embedding.ckpt-1.index -rw-r--r-- 1 nttai nttai 7.5M Jun 10 10:24 embeddings.npy -rw-r--r-- 1 nttai nttai 45G Jun 10 10:27 images.npy -rw-r--r-- 1 nttai nttai 481K Jun 10 10:27 labels.npy -rw-r--r-- 1 nttai nttai 585 Jun 11 15:00 metadata.tsv -rw-r--r-- 1 nttai nttai 144K Jun 11 15:00 sprite.jpg Projector config The last thing we’ll need is the Tensorboard projector config file which specify:\n  The tensor_name. Don’t use embeddings.name, hardcode this line like below. Otherwise it’ll only project a dot for each image.\n  Name of our metadata file.\n  Name of our sprite image.\n  And specify the size of each thumbnail. Tensorboard will use this to split up each of our thumbnails using the sprite image.\n  from tensorboard.plugins import projector config = projector.ProjectorConfig() embedding = config.embeddings.add() # NOTE: Hardcode this line embedding.tensor_name = 'embedding/.ATTRIBUTES/VARIABLE_VALUE' embedding.metadata_path = 'metadata.tsv' embedding.sprite.image_path = 'sprite.jpg' embedding.sprite.single_image_dim.extend([thumbnail_size, thumbnail_size]) projector.visualize_embeddings(log_dir, config) projector_config.pbtxt file should contain these fields.\nembeddings { tensor_name: \"embedding/.ATTRIBUTES/VARIABLE_VALUE\" metadata_path: \"metadata.tsv\" sprite { image_path: \"sprite.jpg\" single_image_dim: 256 single_image_dim: 256 } } $ ls -alh embedding_log/ drwxr-xr-x 3 nttai nttai 4.0K Jun 11 15:00 . drwxrwxr-x 18 nttai nttai 4.0K Jun 10 10:23 .. -rw-r--r-- 1 nttai nttai 89 Jun 11 15:00 checkpoint -rw-r--r-- 1 nttai nttai 13K Jun 11 15:00 embedding.ckpt-1.data-00000-of-00001 -rw-r--r-- 1 nttai nttai 264 Jun 11 15:00 embedding.ckpt-1.index -rw-r--r-- 1 nttai nttai 7.5M Jun 10 10:24 embeddings.npy -rw-r--r-- 1 nttai nttai 45G Jun 10 10:27 images.npy -rw-r--r-- 1 nttai nttai 481K Jun 10 10:27 labels.npy -rw-r--r-- 1 nttai nttai 585 Jun 11 15:00 metadata.tsv -rw-r--r-- 1 nttai nttai 197 Jun 11 15:00 projector_config.pbtxt -rw-r--r-- 1 nttai nttai 144K Jun 11 15:00 sprite.jpg The result Now that we have all required files, let’s run Tensorboard in this directory and checkout the result.\n$ tensorboard --logdir embedding_log/ ... TensorBoard 2.9.0 at http://localhost:6006/ (Press CTRL+C to quit) Open your browser and go to http://localhost:6006 and it should look some thing like this.\n Tensorboard Projector with 100 images     ",
  "wordCount" : "1284",
  "inLanguage": "en",
  "image":"https://blog.nguyentritai.tk/posts/2022/tensorboard-projector-image-visualizer/cover.png","datePublished": "2022-06-10T21:21:31+07:00",
  "dateModified": "2022-06-10T21:21:31+07:00",
  "author":{
    "@type": "Person",
    "name": "Nguyen Tri Tai"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://blog.nguyentritai.tk/posts/2022/tensorboard-projector-image-visualizer/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "nttai",
    "logo": {
      "@type": "ImageObject",
      "url": "https://blog.nguyentritai.tk/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>
<noscript>
    <style type="text/css">
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://blog.nguyentritai.tk/" accesskey="h" title="nttai (Alt + H)">nttai</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="https://blog.nguyentritai.tk/vi/" title="Vietnamese"
                            aria-label=":vi:">Vi</a>
                    </li>
                </ul>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://blog.nguyentritai.tk/posts" title="Posts">
                    <span>Posts</span>
                </a>
            </li>
            <li>
                <a href="https://blog.nguyentritai.tk/archive" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="https://blog.nguyentritai.tk/categories" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="https://blog.nguyentritai.tk/tags" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://blog.nguyentritai.tk/search" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://blog.nguyentritai.tk/about" title="About">
                    <span>About</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
    <header class="post-header">
        <div class="breadcrumbs"><a href="https://blog.nguyentritai.tk/">Home</a>&nbsp;»&nbsp;<a href="https://blog.nguyentritai.tk/posts/">Posts</a></div>
        <h1 class="post-title">
            Tensorboard Projector Image Visualizer with Tensorflow 2
        </h1>
        <div class="post-meta">June 10, 2022&nbsp;·&nbsp;7 min&nbsp;·&nbsp;Nguyen Tri Tai
</div>
    </header> 
<figure class="entry-cover">
        <img loading="lazy" srcset="https://blog.nguyentritai.tk/posts/2022/tensorboard-projector-image-visualizer/cover_hudf77dc75fe6e490ba8f8da82e0ba4009_4867815_360x0_resize_box_3.png 360w ,https://blog.nguyentritai.tk/posts/2022/tensorboard-projector-image-visualizer/cover_hudf77dc75fe6e490ba8f8da82e0ba4009_4867815_480x0_resize_box_3.png 480w ,https://blog.nguyentritai.tk/posts/2022/tensorboard-projector-image-visualizer/cover_hudf77dc75fe6e490ba8f8da82e0ba4009_4867815_720x0_resize_box_3.png 720w ,https://blog.nguyentritai.tk/posts/2022/tensorboard-projector-image-visualizer/cover_hudf77dc75fe6e490ba8f8da82e0ba4009_4867815_1080x0_resize_box_3.png 1080w ,https://blog.nguyentritai.tk/posts/2022/tensorboard-projector-image-visualizer/cover_hudf77dc75fe6e490ba8f8da82e0ba4009_4867815_1500x0_resize_box_3.png 1500w ,https://blog.nguyentritai.tk/posts/2022/tensorboard-projector-image-visualizer/cover.png 3360w"
            sizes="(min-width: 768px) 720px, 100vw" src="https://blog.nguyentritai.tk/posts/2022/tensorboard-projector-image-visualizer/cover.png" alt="Tensorboard visualization" />
        
</figure><div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <div class="details">Table of Contents</div>
        </summary>
        <div class="inner"><ul>
                <li>
                    <a href="#feature-extract-model" aria-label="Feature extract model">Feature extract model</a></li>
                <li>
                    <a href="#sprite-image" aria-label="Sprite image">Sprite image</a></li>
                <li>
                    <a href="#metadata-to-tsv-file" aria-label="Metadata to tsv file">Metadata to tsv file</a></li>
                <li>
                    <a href="#embedding-checkpoint" aria-label="Embedding checkpoint">Embedding checkpoint</a></li>
                <li>
                    <a href="#projector-config" aria-label="Projector config">Projector config</a></li>
                <li>
                    <a href="#the-result" aria-label="The result">The result</a>
                </li>
            </ul>
        </div>
    </details>
</div>

    <div class="post-content"><p>There are not much infomation on the internet on how to visualize your
embeddings with Tensorboard. I&rsquo;ve had a hard time trying to make it work properly.
Although there&rsquo;re some tutorial on the internet but most of them are for Tensorflow 1 and I didn&rsquo;t
find the <a href="https://www.tensorflow.org/tensorboard/tensorboard_projector_plugin">Tensorboard guide</a> documentation page much help. So here&rsquo;s how I make it works and hopefully it&rsquo;ll help you too.
But before we continue, I&rsquo;ll assume you already have an image dataset with labels and a model ready.</p>
<p>Okay let&rsquo;s dive in. Here&rsquo;s what we&rsquo;ll need to do:</p>
<ul>
<li>Use our <code>model</code> to predict the training set and take the output of embedding
layer.</li>
<li>Create a sprite image for projecting image on Tensorboard.</li>
<li>Save the labels (and others if avalable) to a <code>metadata.tsv</code> file</li>
<li>Save a tensorflow checkpoint with embedding vectors as <code>tf.Variable</code></li>
</ul>
<p>All these files must be saved in the same folder since later we&rsquo;ll call
Tensorboard and specify this directory as <code>log_dir</code> for it to find the necessary
files.</p>
<h1 id="feature-extract-model">Feature extract model<a hidden class="anchor" aria-hidden="true" href="#feature-extract-model">#</a></h1>
<p>First create your model and load the appropriate weight. Mine is just a pretrain
ResNet50 with an additional dense layer with 64 neurons as my embedding layer.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">model</span> <span class="o">=</span> <span class="n">create_model</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
<span class="n">log_dir</span> <span class="o">=</span> <span class="s1">&#39;embedding_log&#39;</span>

<span class="n">ckpt_path</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">latest_checkpoint</span><span class="p">(</span><span class="s1">&#39;./checkpoints/ckpt0&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ckpt_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Load ckpt from </span><span class="si">{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ckpt_path</span><span class="p">))</span>
        <span class="n">model</span><span class="o">.</span><span class="n">load_weights</span><span class="p">(</span><span class="n">ckpt_path</span><span class="p">)</span><span class="o">.</span><span class="n">expect_partial</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&#34;No ckpt found&#34;</span><span class="p">)</span>
</code></pre></div><p>Next we&rsquo;ll save the model embedding vectors for future runs. Here I&rsquo;ll loop through the
train dataset, predict on a batch of images and then save the embedding vectors, labels and
images to their appropriate list. If you have the labels and images ready, you
can just call <code>model.predict(train_dataset)</code> directly. It&rsquo;ll process the whole
dataset and output an embedding matrix. This way, you don&rsquo;t have to loop through
the dataset like I do here.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">image_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">label_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">embedding_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="n">steps_per_epoch</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">images</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">embeddings</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">((</span><span class="n">images</span><span class="p">,</span> <span class="n">labels</span><span class="p">))</span>
    <span class="n">embedding_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">embeddings</span><span class="p">)</span>
    <span class="n">label_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">image_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">images</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span>

<span class="n">embeddings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">embedding_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">label_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">images</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">image_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Should save these for future runs</span>
<span class="c1"># Use an if-else block to check if the files exist</span>
<span class="c1"># So you don&#39;t have to loop through the dataset every run.</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log_dir</span><span class="p">,</span> <span class="s1">&#39;embeddings.npy&#39;</span><span class="p">),</span> <span class="n">embeddings</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Saved embeddings to </span><span class="si">{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log_dir</span><span class="p">,</span> <span class="s1">&#39;embeddings.npy&#39;</span><span class="p">)))</span>

<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log_dir</span><span class="p">,</span> <span class="s1">&#39;labels.npy&#39;</span><span class="p">),</span> <span class="n">labels</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Saved labels to </span><span class="si">{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log_dir</span><span class="p">,</span> <span class="s1">&#39;labels.npy&#39;</span><span class="p">)))</span>

<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log_dir</span><span class="p">,</span> <span class="s1">&#39;images.npy&#39;</span><span class="p">),</span> <span class="n">images</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Saved images to </span><span class="si">{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log_dir</span><span class="p">,</span> <span class="s1">&#39;images.npy&#39;</span><span class="p">)))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Embeddings shape: </span><span class="si">{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">embeddings</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Labels shape: </span><span class="si">{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Images shape: </span><span class="si">{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">images</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">Embeddings</span> <span class="n">shape</span><span class="p">:</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Labels</span> <span class="n">shape</span><span class="p">:</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Images</span> <span class="n">shape</span><span class="p">:</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">$ ls -alh embedding_log/
drwxr-xr-x  <span class="m">3</span> nttai nttai 4.0K Jun <span class="m">11</span> 15:00 .
drwxrwxr-x <span class="m">18</span> nttai nttai 4.0K Jun <span class="m">10</span> 10:23 ..
-rw-r--r--  <span class="m">1</span> nttai nttai 7.5M Jun <span class="m">10</span> 10:24 embeddings.npy
-rw-r--r--  <span class="m">1</span> nttai nttai  45G Jun <span class="m">10</span> 10:27 images.npy
-rw-r--r--  <span class="m">1</span> nttai nttai 481K Jun <span class="m">10</span> 10:27 labels.npy
</code></pre></div><h1 id="sprite-image">Sprite image<a hidden class="anchor" aria-hidden="true" href="#sprite-image">#</a></h1>
<p>Next we&rsquo;ll have to create a sprite image so that when we project its embedding
vector onto three dimensional space, Tensorboard will use these thumbnails we
create instead of just a bunch of dots. Just make sure that the indexes stay the
same.</p>
<p>Keep in mind that Tensorboard only accept sprite image with maximum dimension of
8192x8192 pixels so you should select only a subset of the training set. Here,
since my <code>train_dataset</code> only have 100 images, I&rsquo;ll save each thumbnail with
size of 256x256 pixels.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">images_to_sprite</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">log_dir</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
    <span class="n">one_square_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">images</span><span class="p">))))</span>
    <span class="n">master_width</span> <span class="o">=</span> <span class="n">size</span> <span class="o">*</span> <span class="n">one_square_size</span>
    <span class="n">master_height</span> <span class="o">=</span> <span class="n">size</span> <span class="o">*</span> <span class="n">one_square_size</span>
    <span class="n">spriteimage</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
        <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;RGBA&#39;</span><span class="p">,</span>
        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">master_width</span><span class="p">,</span> <span class="n">master_height</span><span class="p">),</span>
        <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Writing sprite image to </span><span class="si">{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log_dir</span><span class="p">,</span> <span class="s1">&#39;sprite.jpg&#39;</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">images</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">images</span><span class="p">)):</span>
        <span class="n">div</span><span class="p">,</span> <span class="n">mod</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">one_square_size</span><span class="p">)</span>
        <span class="n">h_loc</span> <span class="o">=</span> <span class="n">size</span> <span class="o">*</span> <span class="n">div</span>
        <span class="n">w_loc</span> <span class="o">=</span> <span class="n">size</span> <span class="o">*</span> <span class="n">mod</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">))</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>
        <span class="n">spriteimage</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">(</span><span class="n">w_loc</span><span class="p">,</span> <span class="n">h_loc</span><span class="p">))</span>
    <span class="n">spriteimage</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">log_dir</span><span class="si">}</span><span class="s1">/sprite.jpg&#39;</span><span class="p">,</span> <span class="n">transparency</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">thumbnail_size</span> <span class="o">=</span> <span class="mi">256</span>
<span class="n">images_to_sprite</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">log_dir</span><span class="p">,</span> <span class="n">thumbnail_size</span><span class="p">)</span>
</code></pre></div><figure class="align-center ">
    <img loading="lazy" src="./images/sprite.jpeg#center" width="800"/> <figcaption>
            Fashion sprite image
        </figcaption>
</figure>

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">$ ls -alh embedding_log/
drwxr-xr-x  <span class="m">3</span> nttai nttai 4.0K Jun <span class="m">11</span> 15:00 .
drwxrwxr-x <span class="m">18</span> nttai nttai 4.0K Jun <span class="m">10</span> 10:23 ..
-rw-r--r--  <span class="m">1</span> nttai nttai 7.5M Jun <span class="m">10</span> 10:24 embeddings.npy
-rw-r--r--  <span class="m">1</span> nttai nttai  45G Jun <span class="m">10</span> 10:27 images.npy
-rw-r--r--  <span class="m">1</span> nttai nttai 481K Jun <span class="m">10</span> 10:27 labels.npy
-rw-r--r--  <span class="m">1</span> nttai nttai 144K Jun <span class="m">11</span> 15:00 sprite.jpg
</code></pre></div><h1 id="metadata-to-tsv-file">Metadata to tsv file<a hidden class="anchor" aria-hidden="true" href="#metadata-to-tsv-file">#</a></h1>
<p>If you have class names or image ids and you want to display it rather than its class label
you can write those as another column. Note that when there&rsquo;re more than one
column, you&rsquo;re required to write the column labels as the first row, separated
by tabs like so.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">    label   name    image_path
1   0       cat     images/cat/1.jpg
2   1       dog     images/dog/1.jpg
3   1       dog     images/dog/2.jpg
... ...     ...     ...
</code></pre></div><p>Since I only have image labels, I&rsquo;ll use the <code>writerows()</code> method of python
<code>csv</code> package.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">log_dir</span><span class="si">}</span><span class="s1">/metadata.tsv&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fw</span><span class="p">:</span>
    <span class="n">csv_writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">fw</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&#34;</span><span class="se">\t</span><span class="s2">&#34;</span><span class="p">)</span>
    <span class="n">csv_writer</span><span class="o">.</span><span class="n">writerows</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Labels saved to </span><span class="si">{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log_dir</span><span class="p">,</span> <span class="s1">&#39;metadata.tsv&#39;</span><span class="p">)))</span>
</code></pre></div><p>Values inside <code>metadata.tsv</code> should look something like this.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">	2304
1	865
2	3224
3	1440
4	3122
5	4285
6	334
7	5282
8	1744
9	1026
10	6774
...     ...
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">$ ls -alh embedding_log/
drwxr-xr-x  <span class="m">3</span> nttai nttai 4.0K Jun <span class="m">11</span> 15:00 .
drwxrwxr-x <span class="m">18</span> nttai nttai 4.0K Jun <span class="m">10</span> 10:23 ..
-rw-r--r--  <span class="m">1</span> nttai nttai 7.5M Jun <span class="m">10</span> 10:24 embeddings.npy
-rw-r--r--  <span class="m">1</span> nttai nttai  45G Jun <span class="m">10</span> 10:27 images.npy
-rw-r--r--  <span class="m">1</span> nttai nttai 481K Jun <span class="m">10</span> 10:27 labels.npy
-rw-r--r--  <span class="m">1</span> nttai nttai  <span class="m">585</span> Jun <span class="m">11</span> 15:00 metadata.tsv
-rw-r--r--  <span class="m">1</span> nttai nttai 144K Jun <span class="m">11</span> 15:00 sprite.jpg
</code></pre></div><h1 id="embedding-checkpoint">Embedding checkpoint<a hidden class="anchor" aria-hidden="true" href="#embedding-checkpoint">#</a></h1>
<p>Now  create a <code>tf.Variable</code> with the <code>embeddings</code> we extracted above and save it
to the same <code>log_dir</code> directory.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">embeddings</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;embeddings&#39;</span><span class="p">)</span>
<span class="n">checkpoint</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">Checkpoint</span><span class="p">(</span><span class="n">embedding</span><span class="o">=</span><span class="n">embeddings</span><span class="p">)</span>
<span class="n">checkpoint</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log_dir</span><span class="p">,</span> <span class="s2">&#34;embedding.ckpt&#34;</span><span class="p">))</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">$ ls -alh embedding_log/
drwxr-xr-x  <span class="m">3</span> nttai nttai 4.0K Jun <span class="m">11</span> 15:00 .
drwxrwxr-x <span class="m">18</span> nttai nttai 4.0K Jun <span class="m">10</span> 10:23 ..
-rw-r--r--  <span class="m">1</span> nttai nttai   <span class="m">89</span> Jun <span class="m">11</span> 15:00 checkpoint
-rw-r--r--  <span class="m">1</span> nttai nttai  13K Jun <span class="m">11</span> 15:00 embedding.ckpt-1.data-00000-of-00001
-rw-r--r--  <span class="m">1</span> nttai nttai  <span class="m">264</span> Jun <span class="m">11</span> 15:00 embedding.ckpt-1.index
-rw-r--r--  <span class="m">1</span> nttai nttai 7.5M Jun <span class="m">10</span> 10:24 embeddings.npy
-rw-r--r--  <span class="m">1</span> nttai nttai  45G Jun <span class="m">10</span> 10:27 images.npy
-rw-r--r--  <span class="m">1</span> nttai nttai 481K Jun <span class="m">10</span> 10:27 labels.npy
-rw-r--r--  <span class="m">1</span> nttai nttai  <span class="m">585</span> Jun <span class="m">11</span> 15:00 metadata.tsv
-rw-r--r--  <span class="m">1</span> nttai nttai 144K Jun <span class="m">11</span> 15:00 sprite.jpg
</code></pre></div><h1 id="projector-config">Projector config<a hidden class="anchor" aria-hidden="true" href="#projector-config">#</a></h1>
<p>The last thing we&rsquo;ll need is the Tensorboard projector config file which
specify:</p>
<ul>
<li>
<p>The <code>tensor_name</code>. Don&rsquo;t use <code>embeddings.name</code>, hardcode this line like
below. Otherwise it&rsquo;ll only project a dot for each image.</p>
</li>
<li>
<p>Name of our metadata file.</p>
</li>
<li>
<p>Name of our sprite image.</p>
</li>
<li>
<p>And specify the size of each thumbnail. Tensorboard will use this to split
up each of our thumbnails using the sprite image.</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">tensorboard.plugins</span> <span class="kn">import</span> <span class="n">projector</span>

<span class="n">config</span> <span class="o">=</span> <span class="n">projector</span><span class="o">.</span><span class="n">ProjectorConfig</span><span class="p">()</span>
<span class="n">embedding</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">embeddings</span><span class="o">.</span><span class="n">add</span><span class="p">()</span>
<span class="c1"># NOTE: Hardcode this line</span>
<span class="n">embedding</span><span class="o">.</span><span class="n">tensor_name</span> <span class="o">=</span> <span class="s1">&#39;embedding/.ATTRIBUTES/VARIABLE_VALUE&#39;</span>
<span class="n">embedding</span><span class="o">.</span><span class="n">metadata_path</span> <span class="o">=</span> <span class="s1">&#39;metadata.tsv&#39;</span>
<span class="n">embedding</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">image_path</span> <span class="o">=</span> <span class="s1">&#39;sprite.jpg&#39;</span>
<span class="n">embedding</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">single_image_dim</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">thumbnail_size</span><span class="p">,</span> <span class="n">thumbnail_size</span><span class="p">])</span>
<span class="n">projector</span><span class="o">.</span><span class="n">visualize_embeddings</span><span class="p">(</span><span class="n">log_dir</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
</code></pre></div><p><code>projector_config.pbtxt</code> file should contain these fields.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">embeddings {
  tensor_name: &#34;embedding/.ATTRIBUTES/VARIABLE_VALUE&#34;
  metadata_path: &#34;metadata.tsv&#34;
  sprite {
    image_path: &#34;sprite.jpg&#34;
    single_image_dim: 256
    single_image_dim: 256
  }
}
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">$ ls -alh embedding_log/
drwxr-xr-x  3 nttai nttai 4.0K Jun 11 15:00 .
drwxrwxr-x 18 nttai nttai 4.0K Jun 10 10:23 ..
-rw-r--r--  1 nttai nttai   89 Jun 11 15:00 checkpoint
-rw-r--r--  1 nttai nttai  13K Jun 11 15:00 embedding.ckpt-1.data-00000-of-00001
-rw-r--r--  1 nttai nttai  264 Jun 11 15:00 embedding.ckpt-1.index
-rw-r--r--  1 nttai nttai 7.5M Jun 10 10:24 embeddings.npy
-rw-r--r--  1 nttai nttai  45G Jun 10 10:27 images.npy
-rw-r--r--  1 nttai nttai 481K Jun 10 10:27 labels.npy
-rw-r--r--  1 nttai nttai  585 Jun 11 15:00 metadata.tsv
-rw-r--r--  1 nttai nttai  197 Jun 11 15:00 projector_config.pbtxt
-rw-r--r--  1 nttai nttai 144K Jun 11 15:00 sprite.jpg
</code></pre></div><h1 id="the-result">The result<a hidden class="anchor" aria-hidden="true" href="#the-result">#</a></h1>
<p>Now that we have all required files, let&rsquo;s run Tensorboard in this directory and
checkout the result.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">$ tensorboard --logdir embedding_log/
...
TensorBoard 2.9.0 at http://localhost:6006/ (Press CTRL+C to quit)
</code></pre></div><p>Open your browser and go to <code>http://localhost:6006</code> and it should look some thing like this.</p>
<figure class="align-center ">
    <img loading="lazy" src="./images/tensorboard_100_images.png#center" width="800"/> <figcaption>
            Tensorboard Projector with 100 images
        </figcaption>
</figure>


<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://player.vimeo.com/video/719002336" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" title="vimeo video" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
</div>


</div>
    <footer class="post-footer">
        <ul class="post-tags">
            <li><a href="https://blog.nguyentritai.tk/tags/machine-learning/">Machine Learning</a></li>
            <li><a href="https://blog.nguyentritai.tk/tags/tensorboard/">Tensorboard</a></li>
        </ul>
<nav class="paginav">
  <a class="prev" href="https://blog.nguyentritai.tk/posts/2023/oauth2/">
    <span class="title">« Prev Page</span>
    <br>
    <span>Oauth2 - The concept</span>
  </a>
  <a class="next" href="https://blog.nguyentritai.tk/posts/2021/depthwise-separable-convolution/">
    <span class="title">Next Page »</span>
    <br>
    <span>Depthwise Separable Convolution - How does it works?</span>
  </a>
</nav>

<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share Tensorboard Projector Image Visualizer with Tensorflow 2 on twitter"
        href="https://twitter.com/intent/tweet/?text=Tensorboard%20Projector%20Image%20Visualizer%20with%20Tensorflow%202&amp;url=https%3a%2f%2fblog.nguyentritai.tk%2fposts%2f2022%2ftensorboard-projector-image-visualizer%2f&amp;hashtags=MachineLearning%2cTensorboard">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Tensorboard Projector Image Visualizer with Tensorflow 2 on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fblog.nguyentritai.tk%2fposts%2f2022%2ftensorboard-projector-image-visualizer%2f&amp;title=Tensorboard%20Projector%20Image%20Visualizer%20with%20Tensorflow%202&amp;summary=Tensorboard%20Projector%20Image%20Visualizer%20with%20Tensorflow%202&amp;source=https%3a%2f%2fblog.nguyentritai.tk%2fposts%2f2022%2ftensorboard-projector-image-visualizer%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Tensorboard Projector Image Visualizer with Tensorflow 2 on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2fblog.nguyentritai.tk%2fposts%2f2022%2ftensorboard-projector-image-visualizer%2f&title=Tensorboard%20Projector%20Image%20Visualizer%20with%20Tensorflow%202">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Tensorboard Projector Image Visualizer with Tensorflow 2 on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.nguyentritai.tk%2fposts%2f2022%2ftensorboard-projector-image-visualizer%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Tensorboard Projector Image Visualizer with Tensorflow 2 on whatsapp"
        href="https://api.whatsapp.com/send?text=Tensorboard%20Projector%20Image%20Visualizer%20with%20Tensorflow%202%20-%20https%3a%2f%2fblog.nguyentritai.tk%2fposts%2f2022%2ftensorboard-projector-image-visualizer%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Tensorboard Projector Image Visualizer with Tensorflow 2 on telegram"
        href="https://telegram.me/share/url?text=Tensorboard%20Projector%20Image%20Visualizer%20with%20Tensorflow%202&amp;url=https%3a%2f%2fblog.nguyentritai.tk%2fposts%2f2022%2ftensorboard-projector-image-visualizer%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>

    </footer>

    <div id="comments"></div>


<script>
    function getTheme() {
        const light = "github-light"
        const dark = "github-dark"
        if (localStorage.getItem("pref-theme") === "light") {
            return light;
        } else {
            return dark;
        }
    }

    function loadUtterances() {
        const commentsContainer = document.getElementById("comments");
        if (commentsContainer !== null) {
            commentsContainer.innerHTML = ''
            const utterancesScript = document.createElement("script");
            utterancesScript.setAttribute("id", "utterances");
            utterancesScript.setAttribute("src", "https://utteranc.es/client.js");
            utterancesScript.setAttribute("repo", "nguyentritai2906/nguyentritai2906.github.io");
            utterancesScript.setAttribute("issue-term", "pathname");
            utterancesScript.setAttribute("theme", getTheme());
            utterancesScript.setAttribute("crossorigin", "anonymous");
            utterancesScript.setAttribute("async", "true");

            commentsContainer.appendChild(utterancesScript);
        }
    }

    loadUtterances();
</script>

</article>
    </main>
    <footer class="footer">
    <span>&copy; 2023 <a href="https://blog.nguyentritai.tk/">Nguyen Tri Tai</a></span>
    <span>&middot;</span>
    <span>Powered by <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a></span>
    <span>&middot;</span>
    <span>Theme <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a></span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)">
    <button class="top-link" id="top-link" type="button" accesskey="g">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z" />
        </svg>
    </button>
</a>

<script>
    window.onload = function() {
        if (localStorage.getItem("menu-scroll-position")) {
            document.getElementById('menu').scrollLeft = localStorage.getItem("menu-scroll-position");
        }
    }

    function menu_on_scroll() {
        localStorage.setItem("menu-scroll-position", document.getElementById('menu').scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function(e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });
</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function() {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };
</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
            const message = {
                type: 'set-theme',
                theme: 'github-light'
            };
            var utterances = document.querySelector('iframe');
            utterances.contentWindow.postMessage(message, 'https://utteranc.es');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
            const message = {
                type: 'set-theme',
                theme: 'github-dark'
            };
            var utterances = document.querySelector('iframe');
            utterances.contentWindow.postMessage(message, 'https://utteranc.es');
        }
    })
</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) {};
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
